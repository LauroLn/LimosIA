<%- include ('partials/header.ejs') %>
<%- include ('partials/navbar.ejs') %>

<div class="container">
  <div class="card">
      <div class="card-header">
          <h1>Pratos</h1>
      </div>
      <div class="card-body">
          <table class="table table-bordered">
              <thead>
                <tr>
                  <th scope="col">Iniciar Dia</th>
                  <th scope="col">Pratos Consumidos</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <th>    
                      <form class="contact-form row">
                      <div class="form-field col-lg-6" style="width: 210px;">
                         <label class="label" for="name"></label>
                      </div>
                      <div class="col-lg-6"> 
                          <input class="submit-btn" type="submit" value="Iniciar" id="grafico" style="width: 150px; margin-top: 13%; margin-left: -117%;">
                      </div>
                      </form>
                  </th>
                  <td>
                      <form class="contact-form row" action="/controle/adicionar" method="post">
                      <div class="form-field col-lg-6">
                         <input id="Consumidos "name="Consumidos" class="input-text js-input" type="text" required>
                         <label class="label" for="Consumidos"></label>
                      </div>
                      <div class="col-lg-6"> 
                          <input type="hidden" name="id" value="<%= pratoID %>" >
                          <input class="submit-btn" type="submit" value="Contabilizar" style="width: 160px; margin-top: 13%;">
                      </div>
                      </form>
                  </td>
                </tr>
              </tbody>
          </table>
          <canvas id="myChart" style="width:100%; max-width: 700px; margin-left: 17%;"></canvas>
          
          <script>
              function grafico(event) {
                if (event) event.preventDefault(); 
          
                var xValues = ["Feitos", "Consumidos"];
                var yValues = ["<%= pratosFeitos %>", "<%= pratosConsumidos %>"];
                var barColors = ["red", "#00aba9"];

                // Salvando os dados no localStorage
                var chartData = { xValues: xValues, yValues: yValues, barColors: barColors };
                localStorage.setItem('chartData', JSON.stringify(chartData));
          
                // Desenhando o gráfico
                new Chart(document.getElementById("myChart"), {
                  type: "pie",
                  data: {
                    labels: xValues,
                    datasets: [{
                      backgroundColor: barColors,
                      data: yValues,
                    }]
                  },
                  options: {
                    responsive: true,
                    plugins: {
                      legend: {
                        position: 'top',
                      },
                      title: {
                        display: true,
                        text: 'Gráfico de Pratos'
                      }
                    }
                  }
                });
              }
          
              // Função para carregar o gráfico a partir do localStorage
              function loadChart() {
                var storedData = localStorage.getItem('chartData');
                if (storedData) {
                  var chartData = JSON.parse(storedData);
          
                  new Chart(document.getElementById("myChart"), {
                    type: "pie",
                    data: {
                      labels: chartData.xValues,
                      datasets: [{
                        backgroundColor: chartData.barColors,
                        data: chartData.yValues,
                      }]
                    },
                    options: {
                      responsive: true,
                      plugins: {
                        legend: {
                          position: 'top',
                        },
                        title: {
                          display: true,
                          text: 'Gráfico de Pratos'
                        }
                      }
                    }
                  });
                }
              }

             
          
              // Adicionando os event listeners
              document.getElementById("grafico").addEventListener("click", grafico);
              document.getElementById("finalizarDia").addEventListener("click", finalizarDia);

              // Carregar o gráfico quando a página for carregada
              window.onload = loadChart;
          </script>



      </div>
      <table>
        <tr>
          <td>
            <button type="button" id="finalizarDia" class="btn btn-danger" style="background-color: red;">Finalizar Dia</button>
          </td>
        </tr>
      </table>
  </div>
</div>

<%- include ('partials/footer.ejs') %>
